# قراردادهای کلیدی API برای فاز ۱

این سند خلاصهٔ نقاط پایانی موردنیاز فرانت‌اند را براساس ماژول `backend/api` ارائه می‌کند. همهٔ مسیرها زیر دامنهٔ `/api/v1/` منتشر می‌شوند و نیازمند احراز هویت JWT هستند؛ به‌جز مسیرهای اخذ/تازه‌سازی توکن.

## احراز هویت

- `POST /api/auth/jwt/create/` – دریافت جفت توکن دسترسی و بازنشانی با فیلدهای `email` و `password`.
- `POST /api/auth/jwt/refresh/` – دریافت توکن دسترسی جدید با استفاده از توکن بازنشانی معتبر.
- تمام درخواست‌های محافظت‌شده باید هدر `Authorization: Bearer <access_token>` و `Content-Type: application/json` داشته باشند.

## قواعد عمومی

- **مجوزها:** تمامی ویوست‌ها از `IsAuthenticated` استفاده می‌کنند؛ در نتیجه بدون توکن معتبر پاسخ ۴۰۱ باز می‌گردد.
- **صفحه‌بندی:** صفحه‌بندی شماره‌ای با اندازهٔ پیش‌فرض ۱۰ (پارامترهای `page` و `page_size` تا سقف ۱۰۰).
- **جست‌وجو و مرتب‌سازی:** اغلب منابع از پارامترهای `search` و `ordering` پشتیبانی می‌کنند (بر اساس فیلدهای تعریف‌شده در ویوست).
- **فیلترها:** پارامترهای فیلترینگ براساس فیلدهای مدل ساخته می‌شوند (به‌طور خودکار توسط `build_filterset_for_model`).

## کاربران (`/users/`)

- عملیات استاندارد CRUD روی مدل کاربر.
- فیلدهای پاسخ: `id`, `email`, `full_name`, `is_active`, `created_at`, `updated_at`.
- فقط کارکنان می‌توانند همه کاربران را ببینند؛ کاربران معمولی فقط داده‌های خود را دریافت می‌کنند.

## پروفایل کسب‌وکار (`/businesses/`)

- ایجاد پروفایل جدید مالک را به کاربر درخواست‌دهنده متصل می‌کند (`owner` فقط خواندنی است).
- فیلدها: `id`, `owner`, `name`, `description`, `created_at`, `updated_at`.
- امکان جست‌وجو بر اساس نام کسب‌وکار و ایمیل مالک.

## خدمات (`/services/`)

- محدود به خدماتی است که به کسب‌وکارهای متعلق به کاربر وصل هستند (جزء کارکنان).
- فیلدها: `id`, `business`, `name`, `description`, `duration_minutes`, `created_at`, `updated_at`.
- جست‌وجو روی `name`, `description`, `business__name`.

## فهرست‌ها (`/listings/`)

- نمایش و مدیریت خدمات منتشرشده در بازارچه.
- فیلدها: `id`, `business`, `service`, `price`, `is_active`, `created_at`, `updated_at`.
- کاربران غیرکارمند فقط فهرست‌های کسب‌وکار خود را می‌بینند.

## قرار ملاقات (`/appointments/`)

- فیلدها: `id`, `customer`, `business`, `service`, `scheduled_for`, `status`, `notes`, `created_at`, `updated_at`.
- کاربران معمولی فقط قرارهای خود را مشاهده و ویرایش می‌کنند؛ کارکنان دید کامل دارند.

## تراکنش‌ها (`/payments/`)

- فیلدها: `id`, `appointment`, `amount`, `currency`, `status`, `external_reference`, `created_at`, `updated_at`.
- حین ایجاد وضعیت پیش‌فرض «pending» ذخیره می‌شود.
- اکشن سفارشی: `POST /payments/{id}/capture/` برای تسویهٔ تراکنش و ثبت `external_reference`.

## اعلان‌ها (`/notifications/`)

- فیلدها: `id`, `recipient`, `subject`, `body`, `read_at`, `created_at`, `updated_at`.
- کاربران فقط اعلان‌های خود را مشاهده می‌کنند مگر اینکه کارمند باشند.
- اکشن سفارشی: `POST /notifications/send-test/` ارسال اعلان آزمایشی (برای تست رابط کاربری مناسب است).

## توکن‌های طراحی و تعامل

- تمام منابع تاریخ ایجاد/ویرایش را در قالب ISO8601 باز می‌گردانند؛ از این داده‌ها برای اتورنه طراحی استفاده خواهد شد.
- وضعیت‌ها (`status`, `is_active`, `read_at`) برای سناریوهای خطا/هشدار/موفق باید در فرانت‌اند با توکن‌های رنگی فاز بعد نگاشت شوند.

